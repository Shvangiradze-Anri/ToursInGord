import { Fragment, useCallback, useEffect, Suspense, lazy } from "react";
import { useDispatch, useSelector } from "react-redux";
import { Link, useLocation } from "react-router-dom";
import { AppDispatch, RootState } from "../redux/redux";
import { fetchUser } from "../redux/getUser";

// Dynamic imports using React.lazy
const Helmet = lazy(() =>
  import("react-helmet-async").then((module) => ({ default: module.Helmet }))
);

function Admin() {
  const user = useSelector((state: RootState) => state.user.user);
  const location = useLocation();
  const dispatch: AppDispatch = useDispatch();

  // Memoizing fetchUser function
  const fetchUserMemoized = useCallback(() => {
    dispatch(fetchUser());
  }, [dispatch]);

  // Re-fetching user data when component mounts or when user data changes
  useEffect(() => {
    fetchUserMemoized();
  }, [fetchUserMemoized]);

  const isAdmin =
    user && user[0].role === "admin" && location.pathname.startsWith("/admin");

  return (
    <Fragment>
      <Suspense fallback={<div>Loading...</div>}>
        <Helmet>
          <title>Admin Page</title>
          <meta
            name="description"
            content="Admin page where the admin has the ability to change the images and user data."
          />
          <link rel="canonical" href="http://localhost:5173/admin" />
        </Helmet>
      </Suspense>
      <section className="">
        {isAdmin ? (
          <div className="grid gap-8  grid-flow-row h-[100dvh] py-[70%] place-items-center px-4 min-500:py-0 min-500:grid-flow-col min-700:px-12   pt min-900:px-28 bg-[#03e2ff7d] dark:bg-purple-950">
            <div
              title="Galley Images"
              className="bg-gradient-to-b  from-blue-400 cursor-pointer rounded-2xl p-6  min-300:p-5 min-700:p-8 min-1000:p-12 min-1400:p-20  dark:from-purple-600 "
            >
              <Link to="ImagesData/Tour">
                <svg
                  className="h-20 min-500:h-20 min-700:h-28 min-1000:h-36 min-1400:h-44 hover:scale-110 transition-all duration-300"
                  viewBox="0 0 25 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g clipPath="url(#clip0_30_2)">
                    <path
                      className="fill-blue-600  dark:fill-purple-950"
                      d="M2.84093 1.94444C2.68403 1.94444 2.55684 2.0688 2.55684 2.22222V17.7778C2.55684 17.9312 2.68403 18.0555 2.84093 18.0555H22.1591C22.316 18.0555 22.4432 17.9312 22.4432 17.7778V2.22222C22.4432 2.0688 22.316 1.94444 22.1591 1.94444H2.84093ZM0.852295 2.22222C0.852295 1.14833 1.74264 0.277771 2.84093 0.277771H22.1591C23.2574 0.277771 24.1477 1.14833 24.1477 2.22222V17.7778C24.1477 18.8517 23.2574 19.7222 22.1591 19.7222H2.84093C1.74264 19.7222 0.852295 18.8517 0.852295 17.7778V2.22222Z"
                      fill="black"
                    />
                    <path
                      className="fill-blue-400 dark:fill-purple-800"
                      d="M5.39771 5.83332C5.39771 4.91285 6.16085 4.16666 7.10225 4.16666C8.04365 4.16666 8.8068 4.91285 8.8068 5.83332C8.8068 6.7538 8.04365 7.49999 7.10225 7.49999C6.16085 7.49999 5.39771 6.7538 5.39771 5.83332Z"
                      fill="black"
                    />
                    <path
                      className="fill-blue-600  dark:fill-purple-950"
                      d="M12.9893 7.79103C13.2837 7.4553 13.7949 7.40279 14.1541 7.67139L23.8132 14.8937C24.0241 15.0513 24.1477 15.296 24.1477 15.5556V17.7778C24.1477 18.8517 23.2574 19.7222 22.1591 19.7222H2.84093C1.74264 19.7222 0.852295 18.8517 0.852295 17.7778V15.5556C0.852295 15.3346 0.942088 15.1226 1.10192 14.9663L6.78374 9.41076C7.09082 9.11051 7.57968 9.08404 7.9188 9.3493L10.1164 11.0683L12.9893 7.79103ZM13.7589 9.47405L10.8744 12.7646C10.5754 13.1057 10.0537 13.1537 9.69489 12.873L7.44964 11.1167L2.55684 15.9008V17.7778C2.55684 17.9312 2.68403 18.0556 2.84093 18.0556H22.1591C22.316 18.0556 22.4432 17.9312 22.4432 17.7778V15.9674L13.7589 9.47405Z"
                      fill="black"
                    />
                  </g>
                  <defs>
                    <clipPath id="clip0_30_2">
                      <rect width="25" height="20" fill="white" />
                    </clipPath>
                  </defs>
                </svg>
              </Link>
            </div>
            <div
              title="Users Data"
              className="bg-gradient-to-b from-blue-400 cursor-pointer  rounded-2xl p-6 min-300:p-5 min-700:p-8 min-1000:p-12  min-1400:p-20 dark:from-purple-600"
            >
              <Link to="UsersData">
                <svg
                  className="h-20 min-500:h-20 min-700:h-28 min-1000:h-36 min-1400:h-44 hover:scale-110 transition-all duration-300  "
                  viewBox="0 0 23 23"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    className="fill-blue-600    dark:fill-purple-950"
                    d="M1.91663 4.55209C2.31358 4.55209 2.63538 4.87389 2.63538 5.27084H1.91663H1.19788C1.19788 4.87389 1.51967 4.55209 1.91663 4.55209ZM21.0833 5.27084C21.802 5.27084 21.802 5.27089 21.802 5.27099V18.2083C21.802 18.9537 21.3016 19.5196 20.746 19.9137C20.1717 20.321 19.3874 20.6583 18.483 20.9297C16.6648 21.4751 14.1961 21.8021 11.5 21.8021C8.80379 21.8021 6.33514 21.4751 4.517 20.9297C3.6125 20.6583 2.82817 20.321 2.25392 19.9137C1.69835 19.5196 1.1979 18.9537 1.1979 18.2083L1.19788 5.27084C1.19788 5.27075 1.19788 5.27084 1.91663 5.27084C2.63538 5.27084 2.63538 5.27075 2.63538 5.27084L2.6354 18.2083C2.6354 18.2568 2.67126 18.4474 3.08556 18.7412C3.4812 19.0218 4.10031 19.3039 4.93006 19.5528C6.58039 20.048 8.90339 20.3646 11.5 20.3646C14.0966 20.3646 16.4196 20.048 18.0699 19.5528C18.8996 19.3039 19.5187 19.0218 19.9144 18.7412C20.3287 18.4474 20.3645 18.2568 20.3645 18.2083V5.27139C20.3645 5.27129 20.3645 5.27084 21.0833 5.27084ZM21.0833 5.27084L21.802 5.27099C21.8021 4.87403 21.4803 4.55209 21.0834 4.55209C20.6863 4.55209 20.3646 4.87444 20.3645 5.27139L21.0833 5.27084Z"
                    fill="black"
                  />
                  <path
                    className=" fill-blue-600  dark:fill-purple-950"
                    d="M1.91663 13.1771C2.31358 13.1771 2.63538 13.4989 2.63538 13.8958C2.63538 13.9443 2.67125 14.1349 3.08555 14.4287C3.48118 14.7093 4.1003 14.9914 4.93005 15.2403C6.58039 15.7355 8.90339 16.0521 11.5 16.0521C14.0966 16.0521 16.4196 15.7355 18.0699 15.2403C18.8996 14.9914 19.5187 14.7093 19.9144 14.4287C20.3287 14.1349 20.3645 13.9443 20.3645 13.8958C20.3645 13.4989 20.6864 13.1771 21.0833 13.1771C21.4802 13.1771 21.802 13.4989 21.802 13.8958C21.802 14.6412 21.3016 15.2071 20.746 15.6012C20.1717 16.0085 19.3874 16.3458 18.483 16.6172C16.6648 17.1626 14.1961 17.4896 11.5 17.4896C8.80379 17.4896 6.33513 17.1626 4.51699 16.6172C3.61249 16.3458 2.82816 16.0085 2.25391 15.6012C1.69834 15.2071 1.19788 14.6412 1.19788 13.8958C1.19788 13.4989 1.51967 13.1771 1.91663 13.1771Z"
                    fill="black"
                  />
                  <path
                    className="fill-blue-600  dark:fill-purple-950"
                    d="M1.91663 8.86459C2.31358 8.86459 2.63538 9.18639 2.63538 9.58334C2.63538 9.63184 2.67125 9.82235 3.08555 10.1162C3.48118 10.3968 4.1003 10.6789 4.93005 10.9278C6.58039 11.423 8.90339 11.7396 11.5 11.7396C14.0966 11.7396 16.4196 11.423 18.0699 10.9278C18.8996 10.6789 19.5187 10.3968 19.9144 10.1162C20.3287 9.82235 20.3645 9.63184 20.3645 9.58334C20.3645 9.18639 20.6864 8.86459 21.0833 8.86459C21.4802 8.86459 21.802 9.18639 21.802 9.58334C21.802 10.3287 21.3016 10.8946 20.746 11.2887C20.1717 11.696 19.3874 12.0333 18.483 12.3047C16.6648 12.8501 14.1961 13.1771 11.5 13.1771C8.80379 13.1771 6.33513 12.8501 4.51699 12.3047C3.61249 12.0333 2.82816 11.696 2.25391 11.2887C1.69834 10.8946 1.19788 10.3287 1.19788 9.58334C1.19788 9.18639 1.51967 8.86459 1.91663 8.86459Z"
                    fill="black"
                  />
                  <path
                    className="fill-blue-500  dark:fill-purple-900"
                    d="M3.08555 4.25883C2.67125 4.5527 2.63538 4.74316 2.63538 4.79166C2.63538 4.84015 2.67125 5.03062 3.08555 5.32448C3.48119 5.6051 4.1003 5.88722 4.93005 6.13615C6.58039 6.63125 8.90339 6.94791 11.5 6.94791C14.0966 6.94791 16.4196 6.63125 18.0699 6.13615C18.8996 5.88722 19.5187 5.6051 19.9144 5.32448C20.3287 5.03062 20.3645 4.84015 20.3645 4.79166C20.3645 4.74316 20.3287 4.5527 19.9144 4.25883C19.5187 3.97821 18.8996 3.69609 18.0699 3.44716C16.4196 2.95206 14.0966 2.63541 11.5 2.63541C8.90339 2.63541 6.58039 2.95206 4.93005 3.44716C4.1003 3.69609 3.48119 3.97821 3.08555 4.25883ZM4.51699 2.07029C6.33513 1.52484 8.80379 1.19791 11.5 1.19791C14.1961 1.19791 16.6648 1.52484 18.483 2.07029C19.3874 2.34164 20.1717 2.67902 20.746 3.08632C21.3016 3.48038 21.802 4.04625 21.802 4.79166C21.802 5.53707 21.3016 6.10293 20.746 6.49699C20.1717 6.90429 19.3874 7.24167 18.483 7.51303C16.6648 8.05847 14.1961 8.38541 11.5 8.38541C8.80379 8.38541 6.33513 8.05847 4.51699 7.51303C3.61249 7.24167 2.82816 6.90429 2.25391 6.49699C1.69834 6.10293 1.19788 5.53707 1.19788 4.79166C1.19788 4.04625 1.69834 3.48038 2.25391 3.08632C2.82816 2.67902 3.61249 2.34164 4.51699 2.07029Z"
                    fill="black"
                  />
                </svg>
              </Link>
            </div>
          </div>
        ) : null}
      </section>
    </Fragment>
  );
}

export default Admin;
